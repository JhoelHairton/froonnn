<div class="max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen">
  <!-- Header de la Agenda -->
  <div class="flex justify-between items-center mb-6 bg-white rounded-lg shadow-sm p-4">
    <div class="flex flex-col">
      <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
        <i class="fas fa-calendar-alt text-blue-600"></i>
        Mi Agenda
      </h1>
      <div class="text-sm text-gray-600 mt-1">
        {{ fechaActual | date:'EEEE, d MMMM yyyy':'es-ES' }}
      </div>
    </div>
    
    <div class="flex items-center gap-4">
      <div class="flex bg-gray-100 rounded-lg p-1">
        <button 
          *ngFor="let vista of vistas" 
          [class]="'px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center gap-2 ' + (vistaActual === vista.key ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-200')"
          (click)="cambiarVista(vista.key)">
          <i [class]="vista.icon"></i>
          {{ vista.label }}
        </button>
      </div>
      
      <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors duration-200" (click)="abrirModalNuevoEvento()">
        <i class="fas fa-plus"></i>
        Nuevo Evento
      </button>
    </div>
  </div>

  <!-- Navegación del Calendario -->
  <div class="flex justify-between items-center mb-6 bg-white rounded-lg shadow-sm p-4">
    <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200" (click)="navegarFecha(-1)">
      <i class="fas fa-chevron-left"></i>
    </button>
    
    <div class="text-center">
      <h2 *ngIf="vistaActual === 'mes'" class="text-xl font-semibold text-gray-800">{{ mesActual | date:'MMMM yyyy':'es-ES' | titlecase }}</h2>
      <h2 *ngIf="vistaActual === 'semana'" class="text-xl font-semibold text-gray-800">{{ inicioSemana | date:'d MMM':'es-ES' }} - {{ finSemana | date:'d MMM yyyy':'es-ES' }}</h2>
      <h2 *ngIf="vistaActual === 'dia'" class="text-xl font-semibold text-gray-800">{{ fechaSeleccionada | date:'EEEE, d MMMM yyyy':'es-ES' | titlecase }}</h2>
    </div>
    
    <div class="flex items-center gap-2">
      <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200" (click)="navegarFecha(1)">
        <i class="fas fa-chevron-right"></i>
      </button>
      
      <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg ml-2 transition-colors duration-200" (click)="irAHoy()">Hoy</button>
    </div>
  </div>

  <!-- Filtros y Leyenda -->
  <div class="flex justify-between items-center mb-6 bg-white rounded-lg shadow-sm p-4">
    <div class="flex items-center gap-6">
      <div class="flex items-center gap-2">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" [(ngModel)]="filtros.reserva" (change)="aplicarFiltros()" class="sr-only">
          <span class="w-4 h-4 rounded border-2 border-green-400 bg-green-100 flex items-center justify-center">
            <i class="fas fa-check text-green-600 text-xs" *ngIf="filtros.reserva"></i>
          </span>
          <span class="text-sm text-gray-700">Reservas</span>
        </label>
      </div>
      <div class="flex items-center gap-2">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" [(ngModel)]="filtros.disponibilidad" (change)="aplicarFiltros()" class="sr-only">
          <span class="w-4 h-4 rounded border-2 border-blue-400 bg-blue-100 flex items-center justify-center">
            <i class="fas fa-check text-blue-600 text-xs" *ngIf="filtros.disponibilidad"></i>
          </span>
          <span class="text-sm text-gray-700">Disponibilidad</span>
        </label>
      </div>
      <div class="flex items-center gap-2">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" [(ngModel)]="filtros.bloqueado" (change)="aplicarFiltros()" class="sr-only">
          <span class="w-4 h-4 rounded border-2 border-red-400 bg-red-100 flex items-center justify-center">
            <i class="fas fa-check text-red-600 text-xs" *ngIf="filtros.bloqueado"></i>
          </span>
          <span class="text-sm text-gray-700">Bloqueado</span>
        </label>
      </div>
      <div class="flex items-center gap-2">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" [(ngModel)]="filtros.evento" (change)="aplicarFiltros()" class="sr-only">
          <span class="w-4 h-4 rounded border-2 border-purple-400 bg-purple-100 flex items-center justify-center">
            <i class="fas fa-check text-purple-600 text-xs" *ngIf="filtros.evento"></i>
          </span>
          <span class="text-sm text-gray-700">Eventos</span>
        </label>
      </div>
    </div>
    
    <div class="flex items-center gap-4 text-sm text-gray-600">
      <span class="flex items-center gap-1">{{ eventosHoy.length }} eventos hoy</span>
      <span class="flex items-center gap-1">{{ proximasReservas.length }} próximas reservas</span>
    </div>
  </div>

  <!-- Vista Mensual -->
  <div *ngIf="vistaActual === 'mes'" class="bg-white rounded-lg shadow-sm overflow-hidden">
    <div class="grid grid-cols-7 gap-0">
      <!-- Encabezados de días -->
      <div class="bg-gray-50 p-3 text-center text-sm font-medium text-gray-700 border-b border-gray-200" *ngFor="let dia of diasSemana">
        {{ dia }}
      </div>
      
      <!-- Días del calendario -->
      <div 
        *ngFor="let dia of diasMes" 
        [class]="'min-h-32 p-2 border-b border-r border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors duration-150 ' + getDiaClasses(dia)"
        (click)="seleccionarDia(dia.fecha)">
        
        <div class="text-sm font-medium text-gray-700 mb-1">{{ dia.numero }}</div>
        
        <div class="space-y-1">
          <div 
            *ngFor="let evento of getEventosDia(dia.fecha).slice(0, 3)" 
            [class]="'text-xs p-1 rounded truncate cursor-pointer hover:shadow-sm transition-shadow duration-150 ' + 
                     (evento.tipo === 'reserva' ? 'bg-green-100 text-green-800' : 
                      evento.tipo === 'disponibilidad' ? 'bg-blue-100 text-blue-800' : 
                      evento.tipo === 'bloqueado' ? 'bg-red-100 text-red-800' : 
                      'bg-purple-100 text-purple-800')"
            (click)="verEvento(evento, $event)">
            <div class="font-medium">{{ evento.horaInicio }}</div>
            <div class="truncate">{{ evento.titulo }}</div>
          </div>
          
          <div *ngIf="getEventosDia(dia.fecha).length > 3" class="text-xs text-gray-500 p-1">
            +{{ getEventosDia(dia.fecha).length - 3 }} más
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista Semanal -->
  <div *ngIf="vistaActual === 'semana'" class="bg-white rounded-lg shadow-sm overflow-hidden">
    <div class="flex">
      <!-- Columna de horas -->
      <div class="w-16 bg-gray-50 border-r border-gray-200">
        <div class="h-12 border-b border-gray-200"></div>
        <div class="text-xs text-gray-600 p-2 h-16 border-b border-gray-100 flex items-start justify-center" *ngFor="let hora of horasDelDia">
          {{ hora }}
        </div>
      </div>
      
      <!-- Columnas de días -->
      <div 
        *ngFor="let dia of diasSemanaActual" 
        [class]="'flex-1 border-r border-gray-200 relative ' + 
                 (esHoy(dia.fecha) ? 'bg-blue-50' : '') + 
                 (esDiaSeleccionado(dia.fecha) ? 'bg-yellow-50' : '')">
        
        <div class="h-12 p-2 border-b border-gray-200 text-center">
          <div class="text-sm font-medium text-gray-700">{{ dia.nombre }}</div>
          <div class="text-lg font-semibold text-gray-800">{{ dia.numero }}</div>
        </div>
        
        <div class="relative" style="height: 1152px;">
          <div 
            *ngFor="let evento of getEventosDia(dia.fecha)" 
            [class]="'absolute left-1 right-1 text-xs p-1 rounded shadow-sm cursor-pointer z-10 ' + 
                     (evento.tipo === 'reserva' ? 'bg-green-500 text-white' : 
                      evento.tipo === 'disponibilidad' ? 'bg-blue-500 text-white' : 
                      evento.tipo === 'bloqueado' ? 'bg-red-500 text-white' : 
                      'bg-purple-500 text-white')"
            [style.top.px]="getEventoTop(evento.horaInicio)"
            [style.height.px]="getEventoHeight(evento.horaInicio, evento.horaFin)"
            (click)="verEvento(evento, $event)">
            
            <div class="font-medium">{{ evento.horaInicio }} - {{ evento.horaFin }}</div>
            <div class="truncate">{{ evento.titulo }}</div>
            <div class="truncate text-xs opacity-90" *ngIf="evento.cliente">{{ evento.cliente }}</div>
          </div>
          
          <!-- Líneas de hora -->
          <div class="absolute inset-0">
            <div class="h-16 border-b border-gray-100" *ngFor="let hora of horasDelDia"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista Diaria -->
  <div *ngIf="vistaActual === 'dia'" class="bg-white rounded-lg shadow-sm overflow-hidden">
    <div class="flex">
      <div class="w-16 bg-gray-50 border-r border-gray-200">
        <div class="text-xs text-gray-600 p-2 h-16 border-b border-gray-100 flex items-start justify-center" *ngFor="let hora of horasDelDia">
          {{ hora }}
        </div>
      </div>
      
      <div class="flex-1 relative" style="height: 1152px;">
        <div 
          *ngFor="let evento of getEventosDia(fechaSeleccionada)" 
          [class]="'absolute left-2 right-2 text-sm p-3 rounded-lg shadow-md cursor-pointer z-10 ' + 
                   (evento.tipo === 'reserva' ? 'bg-green-500 text-white' : 
                    evento.tipo === 'disponibilidad' ? 'bg-blue-500 text-white' : 
                    evento.tipo === 'bloqueado' ? 'bg-red-500 text-white' : 
                    'bg-purple-500 text-white')"
          [style.top.px]="getEventoTop(evento.horaInicio)"
          [style.height.px]="getEventoHeight(evento.horaInicio, evento.horaFin)"
          (click)="verEvento(evento, $event)">
          
          <div class="font-semibold text-base mb-2">{{ evento.horaInicio }} - {{ evento.horaFin }}</div>
          <div class="font-medium mb-2">{{ evento.titulo }}</div>
          <div class="space-y-1 text-sm opacity-90">
            <div *ngIf="evento.cliente" class="flex items-center gap-2">
              <i class="fas fa-user"></i>
              {{ evento.cliente }}
            </div>
            <div *ngIf="evento.telefono" class="flex items-center gap-2">
              <i class="fas fa-phone"></i>
              {{ evento.telefono }}
            </div>
            <div *ngIf="evento.personas" class="flex items-center gap-2">
              <i class="fas fa-users"></i>
              {{ evento.personas }} personas
            </div>
          </div>
        </div>
        
        <!-- Líneas de hora -->
        <div class="absolute inset-0">
          <div class="h-16 border-b border-gray-100" *ngFor="let hora of horasDelDia"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Próximos Eventos -->
  <div class="mt-6 bg-white rounded-lg shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Próximos Eventos</h3>
    <div class="space-y-3">
      <div *ngFor="let evento of proximosEventos.slice(0, 5)" class="flex items-center gap-4 p-3 hover:bg-gray-50 rounded-lg transition-colors duration-150">
        <div class="text-center min-w-16">
          <div class="text-2xl font-bold text-gray-800">{{ evento.fecha | date:'dd' }}</div>
          <div class="text-sm text-gray-600 uppercase">{{ evento.fecha | date:'MMM':'es-ES' }}</div>
        </div>
        <div class="flex-1">
          <div class="font-medium text-gray-800">{{ evento.titulo }}</div>
          <div class="text-sm text-gray-600">{{ evento.horaInicio }} - {{ evento.horaFin }}</div>
          <div class="text-sm text-gray-500" *ngIf="evento.cliente">{{ evento.cliente }}</div>
        </div>
        <div>
          <span [class]="'px-3 py-1 rounded-full text-xs font-medium ' + 
                       (evento.estado === 'confirmado' ? 'bg-green-100 text-green-800' : 
                        evento.estado === 'pendiente' ? 'bg-yellow-100 text-yellow-800' : 
                        'bg-gray-100 text-gray-800')">
            {{ getEstadoTexto(evento.estado) }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Nuevo Evento -->
<div *ngIf="mostrarModalEvento" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" (click)="cerrarModal()">
  <div class="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">{{ eventoEditando ? 'Editar Evento' : 'Nuevo Evento' }}</h3>
      <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200" (click)="cerrarModal()">
        <i class="fas fa-times text-gray-500"></i>
      </button>
    </div>
    
    <form class="p-6 space-y-4" (ngSubmit)="guardarEvento()">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Título del Evento</label>
        <input type="text" [(ngModel)]="nuevoEvento.titulo" name="titulo" required 
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Evento</label>
          <select [(ngModel)]="nuevoEvento.tipo" name="tipo" required 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="reserva">Reserva</option>
            <option value="disponibilidad">Disponibilidad</option>
            <option value="bloqueado">Bloqueado</option>
            <option value="evento">Evento Personal</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Fecha</label>
          <input type="date" [(ngModel)]="nuevoEvento.fecha" name="fecha" required 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Hora Inicio</label>
          <input type="time" [(ngModel)]="nuevoEvento.horaInicio" name="horaInicio" required 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Hora Fin</label>
          <input type="time" [(ngModel)]="nuevoEvento.horaFin" name="horaFin" required 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
      </div>
      
      <div *ngIf="nuevoEvento.tipo === 'reserva'">
        <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
        <input type="text" [(ngModel)]="nuevoEvento.cliente" name="cliente" 
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      
      <div *ngIf="nuevoEvento.tipo === 'reserva'">
        <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono</label>
        <input type="tel" [(ngModel)]="nuevoEvento.telefono" name="telefono" 
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      
      <div *ngIf="nuevoEvento.tipo === 'reserva'">
        <label class="block text-sm font-medium text-gray-700 mb-2">Número de Personas</label>
        <input type="number" [(ngModel)]="nuevoEvento.personas" name="personas" min="1" 
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
        <textarea [(ngModel)]="nuevoEvento.descripcion" name="descripcion" rows="3" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
      </div>
      
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <button type="button" class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200" (click)="cerrarModal()">
          Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">
          {{ eventoEditando ? 'Actualizar' : 'Crear' }} Evento
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Detalle Evento -->
<div *ngIf="mostrarModalDetalle" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" (click)="cerrarModalDetalle()">
  <div class="bg-white rounded-lg max-w-md w-full" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">{{ eventoSeleccionado?.titulo }}</h3>
      <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200" (click)="cerrarModalDetalle()">
        <i class="fas fa-times text-gray-500"></i>
      </button>
    </div>
    
    <div class="p-6 space-y-4" *ngIf="eventoSeleccionado">
      <div class="flex items-center gap-3 text-gray-700">
        <i class="fas fa-calendar w-5"></i>
        <span>{{ eventoSeleccionado.fecha | date:'EEEE, d MMMM yyyy':'es-ES' }}</span>
      </div>
      
      <div class="flex items-center gap-3 text-gray-700">
        <i class="fas fa-clock w-5"></i>
        <span>{{ eventoSeleccionado.horaInicio }} - {{ eventoSeleccionado.horaFin }}</span>
      </div>
      
      <div class="flex items-center gap-3 text-gray-700" *ngIf="eventoSeleccionado.cliente">
        <i class="fas fa-user w-5"></i>
        <span>{{ eventoSeleccionado.cliente }}</span>
      </div>
      
      <div class="flex items-center gap-3 text-gray-700" *ngIf="eventoSeleccionado.telefono">
        <i class="fas fa-phone w-5"></i>
        <span>{{ eventoSeleccionado.telefono }}</span>
      </div>
      
      <div class="flex items-center gap-3 text-gray-700" *ngIf="eventoSeleccionado.personas">
        <i class="fas fa-users w-5"></i>
        <span>{{ eventoSeleccionado.personas }} personas</span>
      </div>
      
      <div class="flex items-start gap-3 text-gray-700" *ngIf="eventoSeleccionado.descripcion">
        <i class="fas fa-file-text w-5 mt-0.5"></i>
        <span>{{ eventoSeleccionado.descripcion }}</span>
      </div>
      
      <div class="flex gap-3 pt-4 border-t border-gray-200">
        <button class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2 transition-colors duration-200" (click)="editarEvento(eventoSeleccionado)">
          <i class="fas fa-edit"></i>
          Editar
        </button>
        <button class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center justify-center gap-2 transition-colors duration-200" (click)="eliminarEvento(eventoSeleccionado.id)">
          <i class="fas fa-trash"></i>
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

